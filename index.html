<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuratore Serbatoio</title>
    <!-- Inclusione diretta del CSS per l'anteprima -->
    <style>
        body {
            font-family: 'Inter', sans-serif; /* Usiamo Inter come richiesto */
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            color: #333;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            border-radius: 8px; /* Angoli arrotondati per il body */
        }

        header {
            background-color: #3f51b5; /* Blu Material Design */
            color: white;
            padding: 1em 0;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border-bottom-left-radius: 8px; /* Angoli arrotondati */
            border-bottom-right-radius: 8px; /* Angoli arrotondati */
        }

        h1 {
            margin: 0;
            font-size: 2em;
        }

        main {
            flex-grow: 1;
            padding: 20px;
            display: flex; /* Abilita Flexbox per le colonne */
            flex-direction: column; /* Di default, le colonne si impilano su schermi piccoli */
            align-items: flex-start; /* Allinea il contenuto all'inizio (sinistra) */
            gap: 20px; /* Spazio tra le colonne */
            width: 100%; /* Occupa tutta la larghezza disponibile */
            box-sizing: border-box; /* Include padding e border nella larghezza */
        }

        @media (min-width: 768px) {
            main {
                flex-direction: row; /* Su schermi più grandi, le colonne affiancate */
                align-items: flex-start; /* Allinea il contenuto in alto */
                justify-content: space-between; /* Distribuisce lo spazio tra le colonne */
            }
        }

        .left-menu, .right-accessories { /* Stili comuni per i menu laterali */
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 100%; /* Piena larghezza su mobile */
            max-width: 300px; /* Larghezza massima dei menu su desktop */
            box-sizing: border-box;
        }

        @media (min-width: 768px) {
            .left-menu, .right-accessories {
                flex-shrink: 0; /* Non si restringono */
            }
        }

        .center-content { /* Nuovo contenitore per immagine e dettagli */
            flex-grow: 1; /* Occupa lo spazio rimanente al centro */
            display: flex;
            flex-direction: column;
            align-items: center; /* Centra l'immagine e le opzioni all'interno di quest'area */
            width: 100%; /* Piena larghezza su mobile */
            box-sizing: border-box;
        }

        .image-container {
            text-align: center;
            margin-bottom: 30px;
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            max-width: 100%; /* Rende il contenitore responsive */
            box-sizing: border-box;
        }

        .image-container img {
            max-width: 100%; /* Rende l'immagine responsive */
            height: auto;
            display: block; /* Rimuove lo spazio extra sotto l'immagine */
            margin: 0 auto; /* Centra l'immagine */
            border-radius: 4px;
        }

        .image-caption {
            margin-top: 10px;
            font-size: 0.9em;
            color: #666;
        }

        .configurator-options, .accessories-section, .summary-display-area, .materials-display-area { /* Stili per le sezioni interne */
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 600px; /* Limita la larghezza per una migliore leggibilità */
            box-sizing: border-box;
        }

        .configurator-options { /* Spazio sopra la sezione di configurazione */
            margin-top: 20px;
            display: flex; /* Per centrare i pulsanti */
            flex-direction: column; /* Impila i pulsanti verticalmente */
            gap: 15px; /* Spazio tra i pulsanti */
            justify-content: center; /* Centra orizzontalmente */
            align-items: center; /* Centra verticalmente */
            min-height: 100px; /* Altezza minima per il blocco dei pulsanti */
        }

        .left-menu > div { /* Spazio tra i dropdown del menu sinistro */
            margin-top: 20px;
        }
        .left-menu > div:first-of-type {
            margin-top: 0; /* Nessun margine superiore per il primo elemento */
        }

        .accessories-section > div { /* Spazio tra i dropdown degli accessori */
            margin-top: 20px;
        }
        .accessories-section > div:first-child {
            margin-top: 0; /* Nessun margine superiore per il primo elemento */
        }


        .dropdown-label, .input-label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        .dropdown-select, .input-field {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
            background-color: #f9f9f9;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
            box-sizing: border-box;
        }
        
        .dropdown-select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23000%22%20d%3D%22M287%2C114.1L146.2%2C254.9L5.4%2C114.1H287z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 10px top 50%;
            background-size: 12px auto;
        }

        .action-button { /* Stile generico per i pulsanti di azione */
            background-color: #4CAF50; /* Un bel verde */
            color: white;
            padding: 15px 25px;
            border: none;
            border-radius: 8px; /* Angoli arrotondati */
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-decoration: none; /* Rimuove sottolineatura se usato come link */
            display: inline-block; /* Per applicare padding e margin correttamente */
            width: 80%; /* Occupa una buona parte della larghezza del contenitore */
            max-width: 300px; /* Limita la larghezza massima */
        }

        .action-button:hover {
            background-color: #45a049;
            transform: translateY(-2px); /* Effetto leggero al passaggio del mouse */
        }

        .action-button:active {
            background-color: #3e8e41;
            transform: translateY(0);
        }

        .save-button {
            background-color: #2196F3; /* Blu per il pulsante Salva */
        }

        .save-button:hover {
            background-color: #1976D2;
        }

        .save-button:active {
            background-color: #1565C0;
        }

        /* Stili per le nuove aree di visualizzazione */
        .summary-display-area, .materials-display-area {
            display: none; /* Inizialmente nascoste */
            margin-top: 20px;
        }

        .summary-display-area h2, .materials-display-area h2 {
            color: #3f51b5;
            margin-top: 0;
            margin-bottom: 20px;
            text-align: center;
        }

        .summary-details p {
            margin-bottom: 10px;
            font-size: 1.1em;
            line-height: 1.6;
        }

        .summary-details strong {
            color: #555;
            display: inline-block;
            min-width: 150px; /* Allinea i due punti */
        }

        .materials-summary {
            margin-top: 30px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }

        .materials-summary h3 {
            color: #2196F3;
            margin-bottom: 15px;
            text-align: center;
        }

        .materials-summary ul {
            list-style: none;
            padding: 0;
        }

        .materials-summary li {
            background-color: #e3f2fd;
            margin-bottom: 8px;
            padding: 12px;
            border-radius: 5px;
            border-left: 4px solid #2196F3;
            font-size: 1em;
        }

        /* Stili specifici per la lista materiali */
        .materials-container-list { /* Nuovo nome per evitare conflitti */
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            /* margin-top: 30px; Rimosso, gestito dal margin-top del .materials-display-area */
            width: 100%;
            max-width: 800px; /* Larghezza massima per il contenuto */
            box-sizing: border-box;
        }

        .materials-container-list ul {
            list-style: none;
            padding: 0;
        }

        .materials-container-list li {
            background-color: #e8eaf6;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 5px;
            border-left: 5px solid #3f51b5;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1em;
        }

        .material-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .material-name {
            flex-grow: 1;
        }

        .quantity-input {
            width: 70px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
            margin-right: 10px;
        }

        .add-button {
            background-color: #4CAF50;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .add-button:hover {
            background-color: #45a049;
        }

        .added-list-container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-top: 30px; /* Mantieni margine per separare dalla lista disponibile */
            width: 100%;
            max-width: 800px;
            box-sizing: border-box;
        }

        .added-list-container h2 {
            color: #3f51b5;
            text-align: center;
        }

        .added-list ul {
            list-style: decimal; /* Numerazione per la lista aggiunta */
            padding-left: 20px;
        }

        .added-list li {
            background-color: #e3f2fd; /* Sfondo diverso per la lista aggiunta */
            border-left: 5px solid #2196F3;
        }

        /* Stili per i pulsanti nella schermata di riepilogo */
        #summary-display-area .action-button,
        #summary-display-area .back-to-config-button,
        #summary-display-area .export-pdf-button { /* Aggiunto il nuovo pulsante */
            padding: 10px 20px; /* Rendi i pulsanti più piccoli */
            font-size: 1em;    /* Riduci la dimensione del font */
            width: 48%;        /* Circa metà larghezza per stare sulla stessa riga con un po' di spazio */
            max-width: 250px;  /* Limita la larghezza massima per non farli diventare troppo grandi */
            margin-top: 0 !important; /* Rimuovi il margine superiore per allinearli */
            box-sizing: border-box; /* Assicura che padding e border siano inclusi nella larghezza */
        }

        /* Modifica il contenitore dei pulsanti per allinearli sulla stessa riga */
        #summary-display-area.configurator-options {
            flex-direction: row; /* Allinea i pulsanti in una riga */
            flex-wrap: wrap;     /* Permetti ai pulsanti di andare a capo su schermi piccoli */
            justify-content: center; /* Centra i pulsanti orizzontalmente */
            gap: 15px;           /* Spazio tra i pulsanti */
        }

        /* Stili per la descrizione generata */
        .generated-description-container {
            margin-top: 30px;
            padding: 20px;
            background-color: #e8f5e9; /* Verde chiaro per lo sfondo */
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #4CAF50; /* Bordo verde a sinistra */
            color: #333;
            font-size: 1em;
            line-height: 1.6;
            text-align: left;
            width: 100%;
            box-sizing: border-box;
        }

        .generated-description-container h3 {
            color: #4CAF50;
            margin-top: 0;
            margin-bottom: 15px;
            text-align: center;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3f51b5;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin: 10px auto;
            display: none; /* Hidden by default */
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }


        footer {
            background-color: #3f51b5;
            color: white;
            text-align: center;
            padding: 1em 0;
            margin-top: auto;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
        }
    </style>
    <!-- Collega il manifest della PWA (per l'anteprima lo simuliamo) -->
    <link rel="manifest" href="data:application/json;base64,eyJpY29ucyI6W3sic2l6ZXMiOiI3Mng3MiIsInNyYyI6Imh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9icmlzaWNjaGU3OC9jb25maWd1cmF0b3JlL21haW4vc2VyYmF0b2lvLnBuZyIsInR5cGUiOiJpbWFnZS9wbmcifSx7InNpemVzIjoiOTZ4OTYiLCJzcmMiOiJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vYnJpc2ljY2hlNzgvY29uZmlnLXVyYXRvcmUvbWFpbi9zZXJiYXRvaW8ucG5nIiwidHlwZSI6ImltYWdlL3BuZyJ9LHsic2l6ZXMiOiIxMjh4MTI4Iiwic3JjIjoiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2JyaXNpY2NoZTc4L2NvbmZpZ3VyYXRvcmUvbWFpbi9zZXJiYXRvaW8ucG5nIiwidHlwZSI6ImltYWdlL3BuZyJ9LHsic2l6ZXMiOiIxNDR4MTQ0Iiwic3JjIjoiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2JyaXNpY2NoZTc4L2NvbmZpZ3VyYXRvcmUvbWFpbi9zZXJiYXRvaW8ucG5nIiwidHlwZSI6ImltYWdlL3BuZyJ9LHsic2l6ZXMiOiIxNTJ4MTUyIiwic3JjIjoiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2JyaXNpY2NoZTc4L2NvbmZpZ3VyYXRvcmUvbWFpbi9zZXJiYXRvaW8ucG5nIiwidHlwZSI6ImltYWdlL3BuZyJ9LHsic2l6ZXMiOiIxOTJ4MTkyIiwic3JjIjoiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2JyaXNpY2NoZTc4L2NvbmZpZ3VyYXRvcmUvbWFpbi9zZXJiYXRvaW8ucG5nIiwidHlwZSI6ImltYWdlL3BuZyJ9LHsic2l6ZXMiOiIzODR4Mzg0Iiwic3JjIjoiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2JyaXNpY2NoZTc4L2NvbmZpZ3VyYXRvcmUvbWFpbi9zZXJiYXRvaW8ucG5nIiwidHlwZSI6ImltYWdlL3BuZyJ9LHsic2l6ZXMiOiI1MTJ4NTEyIiwic3JjIjoiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2JyaXNpY2NoZTc4L2NvbmZpZ3VyYXRvcmUvbWFpbi9zZXJiYXRvaW8ucG5nIiwidHlwZSI6ImltYWdlL3BuZyJ9XSwibmFtZSI6IkNvbmZpZ3VyYXRvcmUgU2VyYmF0b2lvIiwic2hvcnRfbmFtZSI6IlNlcmJhdG9pbyIsInN0YXJ0X3VybCI6Ii4vaW5kZXguaHRtbCIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiNmZmZmZmYiLCJ0aGVtZV9jb2xvciI6IiMzZjUxYjUiLCJkZXNjcmlwdGlvbiI6IkNvbmZpZ3VyYSBpbCB0dW8gc2VyYmF0b2lvIHBlciBhcmiaWNvbXByZXNzYS4ifQ==">
    <!-- Icona per dispositivi iOS -->
    <link rel="apple-touch-icon" href="https://raw.githubusercontent.com/brisicche78/configuratore/main/serbatoio.png">
    <!-- Colore della barra di stato per Android (Chrome) -->
    <meta name="theme-color" content="#2196F3">
    <!-- Link a Google Fonts per Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <h1>Configuratore Serbatoio</h1>
    </header>

    <main>
        <aside class="left-menu">
            <h2>Seleziona Opzioni</h2>
            <!-- Bar -->
            <div>
                <label for="bar-option" class="dropdown-label">Bar:</label>
                <select id="bar-option" class="dropdown-select">
                    <option value="">Seleziona un valore</option>
                    <option value="10">10</option>
                    <option value="16">16</option>
                </select>
            </div>
            
            <!-- N° di ingressi -->
            <div style="margin-top: 20px;">
                <label for="num-inlets" class="dropdown-label">N° di ingressi:</label>
                <select id="num-inlets" class="dropdown-select">
                    <option value="">Seleziona un valore</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                </select>
            </div>

            <!-- Diametro Ingressi serbatoio (pollici) -->
            <div style="margin-top: 20px;">
                <label for="inlet-diameter" class="dropdown-label">Diametro Ingressi serbatoio (pollici):</label>
                <select id="inlet-diameter" class="dropdown-select">
                    <option value="">Seleziona un valore</option>
                    <option value="2">2"</option>
                    <option value="1.5">1 1/2"</option>
                    <option value="1.25">1 1/4"</option>
                    <option value="1">1"</option>
                    <option value="0.75">3/4"</option>
                    <option value="0.5">1/2"</option>
                </select>
            </div>

            <!-- Nuovo menu a tendina: Diametro Ingresso serbatoio Lato Compressore (inizialmente nascosto) -->
            <div id="compressor-inlet-diameter-container" style="margin-top: 20px; display: none;">
                <label for="compressor-inlet-diameter" class="dropdown-label">Diametro Ingresso serbatoio Lato Compressore (pollici):</label>
                <select id="compressor-inlet-diameter" class="dropdown-select">
                    <option value="">Seleziona un valore</option>
                    <option value="2">2"</option>
                    <option value="1.5">1 1/2"</option>
                    <option value="1.25">1 1/4"</option>
                    <option value="1">1"</option>
                    <option value="0.75">3/4"</option>
                    <option value="0.5">1/2"</option>
                </select>
            </div>
            
            <div style="margin-top: 20px;">
                <label for="top-inlet" class="dropdown-label">Ingresso superiore (pollici):</label>
                <select id="top-inlet" class="dropdown-select">
                    <option value="">Seleziona un valore</option>
                    <option value="2">2"</option>
                    <option value="1.5">1 1/2"</option>
                    <option value="1.25">1 1/4"</option>
                    <option value="1">1"</option>
                    <option value="0.75">3/4"</option>
                    <option value="0.5">1/2"</option>
                </select>
            </div>
            <div style="margin-top: 20px;">
                <label for="bottom-inlet" class="dropdown-label">Ingresso inferiore (pollici):</label>
                <select id="bottom-inlet" class="dropdown-select">
                    <option value="">Seleziona un valore</option>
                    <option value="2">2"</option>
                    <option value="1.5">1 1/2"</option>
                    <option value="1.25">1 1/4"</option>
                    <option value="1">1"</option>
                    <option value="0.75">3/4"</option>
                    <option value="0.5">1/2"</option>
                </select>
            </div>
            <!-- N° di ingressi frontali -->
            <div style="margin-top: 20px;">
                <label for="num-front-inlets" class="dropdown-label">N° di ingressi frontali:</label>
                <select id="num-front-inlets" class="dropdown-select">
                    <option value="">Seleziona un valore</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                </select>
            </div>
            <!-- Nuovo menu a tendina: Diametro Ingresso Frontale (inizialmente nascosto) -->
            <div id="front-inlet-diameter-container" style="margin-top: 20px; display: none;">
                <label for="front-inlet-diameter-option" class="dropdown-label">Diametro Ingresso Frontale (pollici):</label>
                <select id="front-inlet-diameter-option" class="dropdown-select">
                    <option value="">Seleziona un valore</option>
                    <option value="0.375">3/8"</option>
                    <option value="0.25">1/4"</option>
                </select>
            </div>
            
            <!-- Ingresso Impianto (pollici) - SPOSTATO QUI -->
            <div style="margin-top: 20px;">
                <label for="plant-inlet" class="dropdown-label">Ingresso Impianto (pollici):</label>
                <select id="plant-inlet" class="dropdown-select">
                    <option value="">Seleziona un valore</option>
                    <option value="2">2"</option>
                    <option value="1.5">1 1/2"</option>
                    <option value="1.25">1 1/4"</option>
                    <option value="1">1"</option>
                    <option value="0.75">3/4"</option>
                    <option value="0.5">1/2"</option>
                </select>
            </div>

            <!-- By-pass -->
            <div style="margin-top: 20px;">
                <label for="bypass-option" class="dropdown-label">By-pass:</label>
                <select id="bypass-option" class="dropdown-select">
                    <option value="">Seleziona un valore</option>
                    <option value="si">Sì</option>
                    <option value="no">No</option>
                </select>
            </div>

            <!-- Nuovo ordine: Numero Compressori -->
            <div style="margin-top: 20px;">
                <label for="num-compressors" class="dropdown-label">Numero Compressori:</label>
                <select id="num-compressors" class="dropdown-select">
                    <option value="">Seleziona un valore</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                </select>
            </div>
            <!-- Nuovo ordine: Uscita compressore 1 -->
            <div style="margin-top: 20px;">
                <label for="compressor-outlet" class="dropdown-label">Uscita compressore 1 (pollici):</label>
                <select id="compressor-outlet" class="dropdown-select">
                    <option value="">Seleziona un valore</option>
                    <option value="2">2"</option>
                    <option value="1.5">1 1/2"</option>
                    <option value="1.25">1 1/4"</option>
                    <option value="1">1"</option>
                    <option value="0.75">3/4"</option>
                    <option value="0.5">1/2"</option>
                </select>
            </div>
            <!-- Nuovo ordine: Uscita compressore 2 (inizialmente nascosto) -->
            <div id="compressor-outlet-2-container" style="margin-top: 20px; display: none;">
                <label for="compressor-outlet-2" class="dropdown-label">Uscita compressore 2 (pollici):</label>
                <select id="compressor-outlet-2" class="dropdown-select">
                    <option value="">Seleziona un valore</option>
                    <option value="2">2"</option>
                    <option value="1.5">1 1/2"</option>
                    <option value="1.25">1 1/4"</option>
                    <option value="1">1"</option>
                    <option value="0.75">3/4"</option>
                    <option value="0.5">1/2"</option>
                </select>
            </div>
            <!-- Qui potrai aggiungere altri menu a tendina o opzioni -->
        </aside>

        <div class="center-content">
            <!-- Contenitore immagine e pulsanti (inizialmente visibile) -->
            <div id="configurator-view">
                <div class="image-container">
                    <img src="https://i.ibb.co/gF6sfJ5n/serbatoio.png" 
                         alt="Serbatoio per aria compressa"
                         title="Serbatoio per aria compressa"
                         onerror="this.onerror=null;this.src='https://placehold.co/600x400/cccccc/333333?text=Immagine+non+disponibile';">
                </div>
                
                <!-- Sezione Pulsanti Azione -->
                <section class="configurator-options">
                    <button id="open-materials-list-button" class="action-button">Apri Lista Materiali</button>
                    <button id="save-configuration-button" class="action-button save-button">Salva Configurazione</button>
                </section>
            </div>

            <!-- Area di visualizzazione del riepilogo (inizialmente nascosta) -->
            <div id="summary-display-area" class="summary-display-area configurator-options">
                <h2>Riepilogo Configurazione Serbatoio</h2>
                <div id="configuration-details" class="summary-details">
                    <!-- I dettagli della configurazione verranno inseriti qui dal JavaScript -->
                </div>

                <div class="materials-summary">
                    <h3>Stima Materiali</h3>
                    <ul id="estimated-materials-list">
                        <!-- I materiali stimati verranno inseriti qui dal JavaScript -->
                    </ul>
                </div>
                <!-- Nuovo pulsante per l'esportazione PDF -->
                <button id="export-pdf-button" class="action-button save-button">Esporta PDF</button>
                <button id="update-configuration-button" class="action-button save-button">Aggiorna</button>
                <button id="back-from-summary-button" class="back-to-config-button action-button">Torna al Configuratore</button>
            </div>

            <!-- Area di visualizzazione della lista materiali (inizialmente nascosta) -->
            <div id="materials-display-area" class="materials-display-area configurator-options">
                <h2>Lista Materiali Serbatoio</h2>
                <div class="materials-container-list">
                    <h2>Materiali Stimati</h2>
                    <ul id="estimated-materials-dynamic-list">
                        <!-- I materiali stimati verranno inseriti qui dinamicamente -->
                    </ul>
                </div>

                <div class="added-list-container">
                    <h2>Lista Materiali Aggiunti Manualmente</h2>
                    <ul id="added-materials-list" class="added-list">
                        <!-- Gli elementi aggiunti dinamicamente verranno inseriti qui -->
                    </ul>

                    <!-- Sezione per aggiungere materiali manualmente -->
                    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                        <h3>Aggiungi Materiale Manualmente</h3>
                        <label for="manual-material-name" class="input-label">Nome Materiale:</label>
                        <input type="text" id="manual-material-name" class="input-field" placeholder="Es: Tubo PVC">
                        <label for="manual-material-qty" class="input-label" style="margin-top: 10px;">Quantità:</label>
                        <input type="number" min="1" value="1" class="input-field" id="manual-material-qty">
                        <button id="add-manual-material-button" class="add-button" style="margin-top: 15px; width: 100%;">Aggiungi</button>
                    </div>
                </div>
                <button id="back-from-materials-button" class="back-to-config-button action-button">Torna al Configuratore</button>
            </div>
        </div>

        <!-- Sezione Accessori sulla destra -->
        <aside class="right-accessories">
            <section class="accessories-section">
                <h2>Accessori</h2>
                <!-- Manometro -->
                <div>
                    <label for="manometer-option" class="dropdown-label">Manometro:</label>
                    <select id="manometer-option" class="dropdown-select">
                        <option value="">Seleziona un valore</option>
                        <option value="si">Sì</option>
                        <option value="no">No</option>
                    </select>
                </div>
                <!-- Nuovo menu a tendina: Diametro Manometro (inizialmente nascosto) -->
                <div id="manometer-diameter-container" style="margin-top: 20px; display: none;">
                    <label for="manometer-diameter-option" class="dropdown-label">Diametro Manometro (pollici):</label>
                    <select id="manometer-diameter-option" class="dropdown-select">
                        <option value="">Seleziona un valore</option>
                        <option value="0.5">1/2"</option>
                        <option value="0.375">3/8"</option>
                        <option value="0.25">1/4"</option>
                    </select>
                </div>
                <!-- Valvola di sicurezza -->
                <div>
                    <label for="safety-valve-option" class="dropdown-label">Valvola di sicurezza (pollici):</label>
                    <select id="safety-valve-option" class="dropdown-select">
                        <option value="">Seleziona un valore</option>
                        <option value="2">2"</option>
                        <option value="1.5">1 1/2"</option>
                        <option value="1.25">1 1/4"</option>
                        <option value="1">1"</option>
                        <option value="0.75">3/4"</option>
                    <option value="0.5">1/2"</option>
                </select>
                </div>
                <!-- Scaricatore -->
                <div>
                    <label for="drainer-option" class="dropdown-label">Scaricatore:</label>
                    <select id="drainer-option" class="dropdown-select">
                        <option value="">Seleziona un valore</option>
                        <option value="si">Sì</option>
                        <option value="no">No</option>
                    </select>
                </div>
                <!-- Nuovo menu a tendina: Tipo di Scaricatore (inizialmente nascosto) -->
                <div id="drainer-type-container" style="margin-top: 20px; display: none;">
                    <label for="drainer-type-option" class="dropdown-label">Tipo di Scaricatore:</label>
                    <select id="drainer-type-option" class="dropdown-select">
                        <option value="">Seleziona un tipo</option>
                        <option value="ATS">ATS</option>
                        <option value="Beko">Beko</option>
                        <option value="Termodinamico">Termodinamico</option>
                    </select>
                </div>
                <!-- Nuovo menu a tendina: Filtro Ottone -->
                <div id="ottine-filter-container" style="margin-top: 20px;">
                    <label for="ottone-filter-option" class="dropdown-label">Filtro Ottone:</label>
                    <select id="ottone-filter-option" class="dropdown-select">
                        <option value="">Seleziona un valore</option>
                        <option value="si">Sì</option>
                        <option value="no">No</option>
                    </select>
                </div>
                <!-- Il pulsante Reset è stato rimosso -->
                <!-- Qui verranno inseriti gli altri menu per la configurazione degli accessori. -->
            </section>
        </aside>
    </main>

    <footer>
        <p>&copy; 2025 Il Tuo Configuratore Serbatoio</p>
    </footer>

    <!-- Inclusione diretta del JavaScript per l'anteprima -->
    <script>
        // Logica JavaScript per il configuratore
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM completamente caricato e analizzato.');
            
            // Elementi del configuratore
            const barOptionSelect = document.getElementById('bar-option');
            const numInletsSelect = document.getElementById('num-inlets');
            const inletDiameterSelect = document.getElementById('inlet-diameter');
            const topInletSelect = document.getElementById('top-inlet');
            const bottomInletSelect = document.getElementById('bottom-inlet');
            const numFrontInletsSelect = document.getElementById('num-front-inlets');
            const bypassOptionSelect = document.getElementById('bypass-option');
            const compressorOutletSelect = document.getElementById('compressor-outlet');
            const compressorOutlet2Container = document.getElementById('compressor-outlet-2-container'); // Nuovo contenitore
            const compressorOutlet2Select = document.getElementById('compressor-outlet-2'); // Nuovo select
            const manometerOptionSelect = document.getElementById('manometer-option');
            const safetyValveOptionSelect = document.getElementById('safety-valve-option');
            const drainerOptionSelect = document.getElementById('drainer-option');
            const plantInletSelect = document.getElementById('plant-inlet'); // New: Ingresso Impianto
            
            // Nuovi elementi per il diametro manometro
            const manometerDiameterContainer = document.getElementById('manometer-diameter-container');
            const manometerDiameterOptionSelect = document.getElementById('manometer-diameter-option');

            // Nuovi elementi per il tipo di scaricatore
            const drainerTypeContainer = document.getElementById('drainer-type-container');
            const drainerTypeOptionSelect = document.getElementById('drainer-type-option');

            // Nuovo elemento per il filtro Ottone (corretto)
            const ottoneFilterOptionSelect = document.getElementById('ottone-filter-option');
            const ottoneFilterContainer = document.getElementById('ottine-filter-container'); // Riferimento al contenitore (ID HTML precedente, da correggere se necessario)

            // Nuovi elementi per l'ingresso frontale
            const frontInletDiameterContainer = document.getElementById('front-inlet-diameter-container');
            const frontInletDiameterOptionSelect = document.getElementById('front-inlet-diameter-option');

            // Nuovo elemento per Diametro Ingresso serbatoio Lato Compressore
            const compressorInletDiameterContainer = document.getElementById('compressor-inlet-diameter-container');
            const compressorInletDiameterSelect = document.getElementById('compressor-inlet-diameter');

            // Nuovo elemento per Numero Compressori
            const numCompressorsSelect = document.getElementById('num-compressors'); // Nuovo elemento

            // Viste principali
            const configuratorView = document.getElementById('configurator-view');
            const summaryDisplayArea = document.getElementById('summary-display-area');
            const materialsDisplayArea = document.getElementById('materials-display-area');

            // Elementi del riepilogo
            const configurationDetailsDiv = document.getElementById('configuration-details');
            const estimatedMaterialsList = document.getElementById('estimated-materials-list');
            
            // Elementi della lista materiali (per la nuova sezione integrata)
            const estimatedMaterialsDynamicList = document.getElementById('estimated-materials-dynamic-list');
            const addedMaterialsList = document.getElementById('added-materials-list');
            const addManualMaterialButton = document.getElementById('add-manual-material-button');
            const manualMaterialNameInput = document.getElementById('manual-material-name');
            const manualMaterialQtyInput = document.getElementById('manual-material-qty');
            
            // Pulsanti
            const openMaterialsListButton = document.getElementById('open-materials-list-button');
            const saveConfigurationButton = document.getElementById('save-configuration-button');
            const backFromSummaryButton = document.getElementById('back-from-summary-button');
            const backFromMaterialsButton = document.getElementById('back-from-materials-button');
            const updateConfigurationButton = document.getElementById('update-configuration-button'); // Pulsante Aggiorna
            const exportPdfButton = document.getElementById('export-pdf-button'); // Nuovo pulsante Esporta PDF

            // Mappa dei nomi dei parametri URL ai nomi visualizzati (per il riepilogo)
            const paramDisplayNames = {
                bar: 'Bar',
                numInlets: 'N° di ingressi',
                compressorInletDiameter: 'Diametro Ingresso serbatoio Lato Compressore', 
                inletDiameter: 'Diametro Ingressi serbatoio', 
                topInlet: 'Ingresso superiore',
                bottomInlet: 'Ingresso inferiore',
                numFrontInlets: 'N° di ingressi frontali',
                frontInletDiameter: 'Diametro Ingresso Frontale',
                bypass: 'By-pass',
                plantInlet: 'Ingresso Impianto', 
                numCompressors: 'Numero Compressori', 
                compressorOutlet: 'Uscita compressore 1', 
                compressorOutlet2: 'Uscita compressore 2', 
                manometer: 'Manometro',
                manometerDiameter: 'Diametro Manometro',
                safetyValve: 'Valvola di sicurezza',
                drainer: 'Scaricatore',
                drainerType: 'Tipo di Scaricatore',
                ottoneFilter: 'Filtro Ottone'
            };

            // Funzione per raccogliere tutti i valori dei dropdown
            function collectConfiguration() {
                const config = {
                    bar: barOptionSelect ? barOptionSelect.value : '',
                    numInlets: numInletsSelect ? numInletsSelect.value : '',
                    compressorInletDiameter: (numInletsSelect && numInletsSelect.value !== '') ? (compressorInletDiameterSelect ? compressorInletDiameterSelect.value : '') : '',
                    inletDiameter: inletDiameterSelect ? inletDiameterSelect.value : '',
                    topInlet: topInletSelect ? topInletSelect.value : '',
                    bottomInlet: bottomInletSelect ? bottomInletSelect.value : '',
                    numFrontInlets: numFrontInletsSelect ? numFrontInletsSelect.value : '',
                    frontInletDiameter: (numFrontInletsSelect && numFrontInletsSelect.value === '1') ? (frontInletDiameterOptionSelect ? frontInletDiameterOptionSelect.value : '') : '',
                    bypass: bypassOptionSelect ? bypassOptionSelect.value : '',
                    plantInlet: plantInletSelect ? plantInletSelect.value : '', 
                    numCompressors: numCompressorsSelect ? numCompressorsSelect.value : '', 
                    compressorOutlet: compressorOutletSelect ? compressorOutletSelect.value : '', 
                    manometer: manometerOptionSelect ? manometerOptionSelect.value : '',
                    manometerDiameter: (manometerOptionSelect && manometerOptionSelect.value === 'si') ? (manometerDiameterOptionSelect ? manometerDiameterOptionSelect.value : '') : '',
                    safetyValve: safetyValveOptionSelect ? safetyValveOptionSelect.value : '',
                    drainer: drainerOptionSelect ? drainerOptionSelect.value : '',
                    drainerType: (drainerOptionSelect && drainerOptionSelect.value === 'si') ? (drainerTypeOptionSelect ? drainerTypeOptionSelect.value : '') : '',
                    ottoneFilter: ottoneFilterOptionSelect ? ottoneFilterOptionSelect.value : ''
                };

                // Aggiungi il secondo compressore solo se il numero di compressori è 2
                if (config.numCompressors === '2') {
                    config.compressorOutlet2 = compressorOutlet2Select ? compressorOutlet2Select.value : '';
                }
                return config;
            }

            // Funzione per formattare i valori in pollici per la visualizzazione
            function formatInchValue(value) {
                if (!value) return '';
                // Rimuovi esplicitamente qualsiasi carattere virgoletta dall'input
                value = String(value).replace(/"/g, ''); 
                // Convert string values to their common fractional/decimal representation for display
                if (value === '1.5') return '1 1/2 pollici';
                if (value === '1.25') return '1 1/4 pollici';
                if (value === '0.75') return '3/4 pollici';
                if (value === '0.5') return '1/2 pollici';
                if (value === '0.375') return '3/8 pollici';
                if (value === '0.25') return '1/4 pollici';
                return `${value} pollici`;
            }

            // Funzione per convertire i valori in pollici (stringa) in numeri decimali per i calcoli
            function parseInchToDecimal(value) {
                if (!value) return null;
                // Handle common fractional representations if they were in the value string
                if (value === '1 1/2') return 1.5;
                if (value === '1 1/4') return 1.25;
                if (value === '3/4') return 0.75;
                if (value === '1/2') return 0.5;
                if (value === '3/8') return 0.375;
                if (value === '1/4') return 0.25;
                return parseFloat(value); // For direct decimal or integer strings
            }

            // Funzione per calcolare i materiali stimati
            function calculateEstimatedMaterials(config) {
                const materials = [];

                // Logica per Tappi inox
                let tappiInoxQty = 0;
                let tappiInoxName = 'Tappi inox';
                const numInlets = config.numInlets;
                const numCompressors = config.numCompressors;

                if (numInlets === '3' && numCompressors === '2') {
                    tappiInoxQty = 0;
                } else if (numInlets === '4' && numCompressors === '2') {
                    tappiInoxQty = 1;
                } else if (numInlets === '2') {
                    tappiInoxQty = 0;
                } else if (numInlets === '3') {
                    tappiInoxQty = 1;
                } else if (numInlets === '4') {
                    tappiInoxQty = 2;
                }
                
                if (config.inletDiameter && config.inletDiameter !== '') {
                    tappiInoxName += ` ${formatInchValue(config.inletDiameter)}`;
                }
                materials.push({ name: tappiInoxName, quantity: tappiInoxQty });

                // Altri materiali basati sulle selezioni
                if (config.manometer === 'si') {
                    let manometerText = 'Manometro';
                    if (config.manometerDiameter && config.manometerDiameter !== '') {
                        manometerText += ` (${formatInchValue(config.manometerDiameter)})`;
                    }
                    materials.push({ name: manometerText, quantity: 1 });

                    if (config.manometerDiameter === '0.25') {
                        materials.push({ name: 'Riduzione 3/8 - 1/4', quantity: 1 });
                    }

                    if (config.numFrontInlets === '1' && config.frontInletDiameter) {
                        const frontInletDiameterFormatted = formatInchValue(config.frontInletDiameter);
                        materials.push({ name: `Niples ${frontInletDiameterFormatted}`, quantity: 1 });
                        materials.push({ name: `T ${frontInletDiameterFormatted}`, quantity: 1 });
                        materials.push({ name: `Rubinetto minisfera MF ${frontInletDiameterFormatted}`, quantity: 1 });
                        materials.push({ name: `Attacco rapido universale ${frontInletDiameterFormatted}`, quantity: 1 });
                    }
                }
                if (config.safetyValve && config.safetyValve !== '') {
                    materials.push({ name: `Valvola di sicurezza (${formatInchValue(config.safetyValve)})`, quantity: 1 });
                    const topInlet = config.topInlet;
                    const safetyValve = config.safetyValve;

                    if (topInlet && safetyValve) {
                        const topInletDecimal = parseInchToDecimal(topInlet);
                        const safetyValveDecimal = parseInchToDecimal(safetyValve);

                        if (topInletDecimal > safetyValveDecimal) {
                            if (safetyValveDecimal >= 1.0) {
                                materials.push({ name: `Riduzione ${formatInchValue(topInlet)} - ${formatInchValue(safetyValve)}`, quantity: 1 });
                            } else {
                                materials.push({ name: `Riduzione ${formatInchValue(topInlet)} - 1 pollice`, quantity: 1 });
                                materials.push({ name: `Riduzione 1 pollice - ${formatInchValue(safetyValve)}`, quantity: 1 });
                            }
                        }
                    }
                }
                if (config.drainer === 'si') {
                    if (config.drainerType === 'ATS') {
                        materials.push({ name: 'Scaricatore (Kit ATS)', quantity: 1 });
                    } else {
                        let drainerText = 'Scaricatore';
                        if (config.drainerType && config.drainerType !== '') {
                            drainerText += ` (${config.drainerType})`;
                        }
                        materials.push({ name: drainerText, quantity: 1 });
                    }
                    materials.push({ name: 'Valvola 1/2 MF', quantity: 1 }); 
                    materials.push({ name: 'Curva 1/2 MF', quantity: 1 });
                    materials.push({ name: 'Bocchettone 1/2 MF', quantity: 1 });
                }
                if (config.ottoneFilter === 'si' && config.drainerType !== 'ATS') {
                    materials.push({ name: 'Filtro Ottone', quantity: 1 }); 
                }

                if (config.drainerType === 'ATS' || config.drainerType === 'Beko') {
                    materials.push({ name: '10 mt di cavo 2x1,5mm', quantity: 1 });
                    materials.push({ name: 'Spina industriale', quantity: 1 });
                    materials.push({ name: 'Spina civile', quantity: 1 });
                }

                if (config.compressorOutlet && config.compressorOutlet !== '') {
                    materials.push({ name: `Valvola ${formatInchValue(config.compressorOutlet)} M/F (Compressore 1)`, quantity: 1 }); 
                }
                if (config.compressorOutlet2 && config.compressorOutlet2 !== '') {
                    materials.push({ name: `Valvola ${formatInchValue(config.compressorOutlet2)} M/F (Compressore 2)`, quantity: 1 }); 
                }

                if (config.bypass === 'si') {
                    const plantInletFormatted = formatInchValue(config.plantInlet);
                    materials.push({ name: `T ${plantInletFormatted}`, quantity: 2 });
                    materials.push({ name: `Niples ${plantInletFormatted}`, quantity: 3 });
                    materials.push({ name: `Valvole MF ${plantInletFormatted}`, quantity: 3 });
                }

                const compressorInlet = config.compressorInletDiameter;
                const compressorOutlet = config.compressorOutlet;

                if (compressorInlet && compressorOutlet) {
                    const inletDecimal = parseInchToDecimal(compressorInlet);
                    const outletDecimal = parseInchToDecimal(compressorOutlet);

                    if (inletDecimal > outletDecimal) {
                        if (outletDecimal >= 1.0) {
                            materials.push({ name: `Riduzione ${formatInchValue(compressorInlet)} - ${formatInchValue(compressorOutlet)}`, quantity: 1 });
                        } else {
                            materials.push({ name: `Riduzione ${formatInchValue(compressorInlet)} - 1 pollice`, quantity: 1 });
                            materials.push({ name: `Riduzione 1 pollice - ${formatInchValue(compressorOutlet)}`, quantity: 1 });
                        }
                    } else if (inletDecimal === outletDecimal) {
                        materials.push({ name: `Niples ${formatInchValue(compressorInlet)}`, quantity: 1 });
                    }
                }
                if (config.numCompressors === '2' && compressorInlet && config.compressorOutlet2) {
                    const inletDecimal = parseInchToDecimal(compressorInlet);
                    const outlet2Decimal = parseInchToDecimal(config.compressorOutlet2);

                    if (inletDecimal > outlet2Decimal) {
                        if (outlet2Decimal >= 1.0) {
                            materials.push({ name: `Riduzione ${formatInchValue(compressorInlet)} - ${formatInchValue(config.compressorOutlet2)} (Compressore 2)`, quantity: 1 });
                        } else {
                            materials.push({ name: `Riduzione ${formatInchValue(compressorInlet)} - 1 pollice (Compressore 2)`, quantity: 1 });
                            materials.push({ name: `Riduzione 1 pollice - ${formatInchValue(config.compressorOutlet2)} (Compressore 2)`, quantity: 1 });
                        }
                    } else if (inletDecimal === outlet2Decimal) {
                        materials.push({ name: `Niples ${formatInchValue(compressorInlet)} (Compressore 2)`, quantity: 1 });
                    }
                }
                return materials;
            }


            // Funzione per generare e mostrare il riepilogo
            function showSummary() {
                const config = collectConfiguration();
                const materials = calculateEstimatedMaterials(config); // Calcola i materiali qui
                
                // Pulisci le aree prima di riempirle
                configurationDetailsDiv.innerHTML = '';
                estimatedMaterialsList.innerHTML = '';

                // Popola i dettagli della configurazione
                let detailsHtml = '';
                for (const key in config) {
                    if (config.hasOwnProperty(key) && config[key] !== '') { // Mostra solo le opzioni selezionate
                        let displayValue = config[key];
                        // Modifica la visualizzazione per Tipo di Scaricatore se è ATS
                        if (key === 'drainerType' && config[key] === 'ATS') {
                            displayValue = 'Kit ATS';
                        }
                        // Non mostrare il filtro ottone se è parte del Kit ATS
                        if (key === 'ottoneFilter' && config.drainerType === 'ATS') {
                            continue; // Salta l'aggiunta di questa riga
                        }
                        // Formatta i valori in pollici per la visualizzazione nel riepilogo
                        if (['inletDiameter', 'topInlet', 'bottomInlet', 'frontInletDiameter', 'compressorOutlet', 'compressorOutlet2', 'plantInlet', 'manometerDiameter', 'safetyValve', 'compressorInletDiameter'].includes(key)) {
                            displayValue = formatInchValue(config[key]);
                        }
                        detailsHtml += `<p><strong>${paramDisplayNames[key] || key}:</strong> ${displayValue}</p>`;
                    }
                }
                configurationDetailsDiv.innerHTML = detailsHtml;

                // Popola la lista dei materiali stimati
                if (materials.length > 0) {
                    materials.forEach(item => {
                        const listItem = document.createElement('li');
                        listItem.textContent = `${item.name}: ${item.quantity}`;
                        estimatedMaterialsList.appendChild(listItem);
                    });
                } else {
                    const listItem = document.createElement('li');
                    listItem.textContent = 'Nessun materiale stimato in base alle selezioni.';
                    estimatedMaterialsList.appendChild(listItem);
                }

                // Nascondi le altre viste e mostra il riepilogo
                configuratorView.style.display = 'none';
                materialsDisplayArea.style.display = 'none';
                summaryDisplayArea.style.display = 'block';
            }

            // Funzione per mostrare la lista materiali (ora all'interno della stessa pagina)
            function showMaterialsList() {
                const config = collectConfiguration();
                const materials = calculateEstimatedMaterials(config);
                
                // Pulisci la lista dinamica prima di riempirla
                estimatedMaterialsDynamicList.innerHTML = '';
                addedMaterialsList.innerHTML = ''; // Pulisci anche la lista aggiunta manualmente

                if (materials.length > 0) {
                    materials.forEach(item => {
                        const listItem = document.createElement('li');
                        listItem.innerHTML = `<span class="material-name"><strong>${item.name}</strong></span><span>Quantità: ${item.quantity}</span>`;
                        estimatedMaterialsDynamicList.appendChild(listItem);
                    });
                } else {
                    const listItem = document.createElement('li');
                    listItem.textContent = 'Nessun materiale stimato disponibile.';
                    estimatedMaterialsDynamicList.appendChild(listItem);
                }

                // Nascondi le altre viste e mostra la lista materiali
                configuratorView.style.display = 'none';
                summaryDisplayArea.style.display = 'none';
                materialsDisplayArea.style.display = 'block';
            }

            // Funzione per tornare alla vista del configuratore principale
            function showConfigurator() {
                summaryDisplayArea.style.display = 'none';
                materialsDisplayArea.style.display = 'none';
                configuratorView.style.display = 'block';
            }

            // Event Listener per il pulsante "Apri Lista Materiali"
            if (openMaterialsListButton) {
                openMaterialsListButton.addEventListener('click', showMaterialsList);
            }

            // Event Listener per il pulsante "Salva Configurazione"
            if (saveConfigurationButton) {
                saveConfigurationButton.addEventListener('click', showSummary);
            }

            // Event Listener per il pulsante "Torna al Configuratore" dalla vista Riepilogo
            if (backFromSummaryButton) {
                    backFromSummaryButton.addEventListener('click', showConfigurator);
            }

            // Event Listener per il pulsante "Torna al Configuratore" dalla vista Lista Materiali
            if (backFromMaterialsButton) {
                backFromMaterialsButton.addEventListener('click', showConfigurator);
            }

            // Event Listener per il nuovo pulsante "Aggiorna" nella schermata di riepilogo
            if (updateConfigurationButton) {
                updateConfigurationButton.addEventListener('click', showSummary); // Richiama showSummary per aggiornare il riepilogo
            }

            // Aggiungi event listener a tutti i pulsanti "Aggiungi" nella lista materiali
            // Questo blocco è ora per la sezione "Aggiungi Materiale Manualmente"
            if (addManualMaterialButton) {
                addManualMaterialButton.addEventListener('click', () => {
                    const name = manualMaterialNameInput.value.trim();
                    const qty = parseInt(manualMaterialQtyInput.value, 10);
                    if (name && qty > 0) {
                        const listItem = document.createElement('li');
                        listItem.textContent = `${name}: ${qty}`;
                        addedMaterialsList.appendChild(listItem);
                    }
                    manualMaterialNameInput.value = ''; // Resetta il campo nome
                    manualMaterialQtyInput.value = 1; // Resetta la quantità
                });
            }

            // Logica per mostrare/nascondere il menu a tendina del diametro manometro
            if (manometerOptionSelect) {
                manometerOptionSelect.addEventListener('change', (event) => {
                    const selectedValue = event.target.value;
                    if (selectedValue === 'si') {
                        manometerDiameterContainer.style.display = 'block';
                    } else {
                        manometerDiameterContainer.style.display = 'none';
                        manometerDiameterOptionSelect.value = ''; // Resetta il valore quando nascosto
                    }
                    console.log('Opzione Manometro selezionata:', selectedValue);
                });
            }

            // Event listener per il diametro del manometro
            if (manometerDiameterOptionSelect) {
                manometerDiameterOptionSelect.addEventListener('change', (event) => {
                    console.log('Diametro Manometro selezionato:', event.target.value + '"');
                });
            }

            // Logica per mostrare/nascondere il menu a tendina del tipo di scaricatore
            if (drainerOptionSelect) {
                drainerOptionSelect.addEventListener('change', (event) => {
                    const selectedValue = event.target.value;
                    if (selectedValue === 'si') {
                        drainerTypeContainer.style.display = 'block';
                        // Quando lo scaricatore è 'si', abilita il filtro ottone e resettalo
                        ottoneFilterOptionSelect.disabled = false;
                        ottoneFilterOptionSelect.value = ''; 
                    } else {
                        drainerTypeContainer.style.display = 'none';
                        drainerTypeOptionSelect.value = ''; // Resetta il valore quando nascosto
                        // Quando lo scaricatore è 'no', disabilita il filtro ottone e resettalo
                        ottoneFilterOptionSelect.value = ''; 
                        ottoneFilterOptionSelect.disabled = false; // Lascialo abilitato, ma resettato
                    }
                    console.log('Opzione Scaricatore selezionata:', selectedValue);
                });
            }

            // Event listener per il tipo di scaricatore
            if (drainerTypeOptionSelect) {
                drainerTypeOptionSelect.addEventListener('change', (event) => {
                    const selectedValue = event.target.value;
                    if (selectedValue === 'ATS') {
                        ottoneFilterOptionSelect.value = 'si';
                        ottoneFilterOptionSelect.disabled = true; // Disabilita se ATS
                    } else if (selectedValue === 'Beko' || selectedValue === 'Termodinamico') {
                        ottoneFilterOptionSelect.value = 'si';
                        ottoneFilterOptionSelect.disabled = false; // Abilita se Beko o Termodinamico
                    } else {
                        ottoneFilterOptionSelect.value = ''; // Resetta se nessuna selezione specifica
                        ottoneFilterOptionSelect.disabled = false; // Abilita
                    }
                    console.log('Tipo di Scaricatore selezionato:', selectedValue);
                });
            }

            // Event listener per il filtro Ottone
            if (ottoneFilterOptionSelect) {
                ottoneFilterOptionSelect.addEventListener('change', (event) => {
                    console.log('Filtro Ottone selezionato:', event.target.value);
                });
            }

            // Logica per mostrare/nascondere il menu a tendina del diametro ingresso frontale
            if (numFrontInletsSelect) {
                numFrontInletsSelect.addEventListener('change', (event) => {
                    const selectedValue = event.target.value;
                    if (selectedValue === '1') {
                        frontInletDiameterContainer.style.display = 'block';
                    } else {
                        frontInletDiameterContainer.style.display = 'none';
                        frontInletDiameterOptionSelect.value = ''; // Resetta il valore quando nascosto
                    }
                    console.log('N° di ingressi frontali selezionato:', selectedValue);
                });
            }

            // Event listener per il diametro ingresso frontale
            if (frontInletDiameterOptionSelect) {
                frontInletDiameterOptionSelect.addEventListener('change', (event) => {
                    console.log('Diametro Ingresso Frontale selezionato:', event.target.value + '"');
                });
            }

            // Event listener per Ingresso Impianto
            if (plantInletSelect) {
                plantInletSelect.addEventListener('change', (event) => {
                    console.log('Ingresso Impianto selezionato:', event.target.value + '"');
                });
            }

            // LOGICA: Mostra/nascondi Diametro Ingresso serbatoio Lato Compressore in base a N° di ingressi
            if (numInletsSelect) {
                numInletsSelect.addEventListener('change', (event) => {
                    const selectedValue = event.target.value;
                    // Mostra il campo "Diametro Ingresso serbatoio Lato Compressore" solo se "N° di ingressi" non è vuoto
                    if (selectedValue !== '') { 
                        compressorInletDiameterContainer.style.display = 'block';
                    } else {
                        compressorInletDiameterContainer.style.display = 'none';
                        compressorInletDiameterSelect.value = ''; // Resetta il valore quando nascosto
                    }
                    console.log('N° di ingressi selezionato:', selectedValue);
                });
            }

            // Event listener per Numero Compressori (nuovo)
            if (numCompressorsSelect) {
                numCompressorsSelect.addEventListener('change', (event) => {
                    const selectedValue = event.target.value;
                    if (selectedValue === '2') {
                        compressorOutlet2Container.style.display = 'block'; // Mostra il secondo menu
                    } else {
                        compressorOutlet2Container.style.display = 'none'; // Nascondi il secondo menu
                        compressorOutlet2Select.value = ''; // Resetta il valore
                    }
                    console.log('Numero Compressori selezionato:', selectedValue);
                });
            }

            // Funzione per esportare la lista materiali in PDF
            if (exportPdfButton) {
                exportPdfButton.addEventListener('click', () => {
                    const config = collectConfiguration();
                    const materials = calculateEstimatedMaterials(config); // Calcola i materiali qui
                    
                    let pdfContent = `Report di Configurazione Serbatoio\n`;
                    pdfContent += `Data: ${new Date().toLocaleDateString('it-IT')}\n`;
                    pdfContent += `Ora: ${new Date().toLocaleTimeString('it-IT')}\n`;
                    pdfContent += `========================================\n\n`;

                    pdfContent += `Dettagli Configurazione:\n`;
                    for (const key in config) {
                        if (config.hasOwnProperty(key) && config[key] !== '') {
                            let displayValue = config[key];
                            if (key === 'drainerType' && config[key] === 'ATS') {
                                displayValue = 'Kit ATS';
                            }
                            if (key === 'ottoneFilter' && config.drainerType === 'ATS') {
                                continue;
                            }
                            if (['inletDiameter', 'topInlet', 'bottomInlet', 'frontInletDiameter', 'compressorOutlet', 'compressorOutlet2', 'plantInlet', 'manometerDiameter', 'safetyValve', 'compressorInletDiameter'].includes(key)) {
                                displayValue = formatInchValue(config[key]);
                            }
                            pdfContent += `${paramDisplayNames[key] || key}: ${displayValue}\n`;
                        }
                    }
                    pdfContent += `\n========================================\n\n`;

                    pdfContent += `Stima Materiali:\n`;
                    if (materials.length > 0) {
                        materials.forEach((item, index) => {
                            pdfContent += `${index + 1}. ${item.name}: ${item.quantity}\n`;
                        });
                    } else {
                        pdfContent += 'Nessun materiale stimato in base alle selezioni.\n';
                    }

                    // Apriamo una nuova finestra con il contenuto testuale migliorato
                    const newWindow = window.open('', '_blank');
                    newWindow.document.write('<pre>' + pdfContent + '</pre>');
                    newWindow.document.title = 'Report Serbatoio - ' + new Date().toLocaleDateString('it-IT');
                    newWindow.document.close();

                    console.log('Contenuto che verrebbe esportato nel PDF:\n', pdfContent);
                });
            }
        });
    </script>
</body>
</html>